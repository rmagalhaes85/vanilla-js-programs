<html>
  <header>
    <title>What time is it?</title>
    <style>
  /*

     display: flex;
  justify-content: center;
  align-items: center;

    transform-origin: left 50%;
    transform: rotate(0.25turn);

   */
#container {
  display: flex;
  justify-content: space-around;
  border: 10px outset gray;
  padding: 10px;
}

#clockContainer {
  padding: 10px;
  border: 10px outset red;
}

#statisticsContainer {
  padding: 10px;
  border: 10px outset gray;
}

#clock {
  position: relative;
  padding: 0;
  background-color: yellow;
  border-radius: 50%;
  border: 1px solid black;
  height: 15em;
  width: 15em;
  margin: auto;
  margin-top: 10px;
  margin-bottom: 10px;
}
  #clock ul {
    margin: 0;
    padding: 0;
  }
  #hoursPointer {
    position: absolute;
    border: 2px solid red;
    background: red;
    height: 0.5em;
    width: 4.5em;
    left: 50%;
    top: 50%;
    transform-origin: left 50%;
    transform: rotate(-90deg);
  }
  #minutesPointer {
    position: absolute;
    border: 2px solid blue;
    background: blue;
    height: 0.5em;
    width: 6.5em;
    left: 50%;
    top: 50%;
    transform-origin: left 50%;
    transform: rotate(-90deg);
  }
    </style>
  </header>

  <body>

    <div id="container">

      <div id="clockContainer">
          <div id="clock">
            <ul class="marks">
            </ul>
            <ul class="numbers">
            </ul>
            <div id="minutesPointer">&nbsp;</div>
            <div id="hoursPointer">&nbsp;</div>
          </div>
          <div id="inputContainer">
            <input type="text" id="txtInformedTime" placeholder="What time is it? (HHMM)"
              maxlength="4">
            <button id="btnGo">Go! (ENTER)</button>
          </div>

      </div>

      <div id="statisticsContainer">
        &nbsp;
      </div>

    </div>

  </body>

<script type="text/javascript">
  let currentlyDisplayedTime;
  let errorMagnitudes = [];
  let statistics = {avgErrorMag: 0};

const txtInformedTime = document.getElementById("txtInformedTime");
const btnGo = document.getElementById("btnGo");

txtInformedTime.addEventListener('keypress', (e) => {
  if (e.key === 'Enter')
    registerInformedTimeStr(e.target.value);
});

btnGo.addEventListener('click', e => {
  if (!currentlyDisplayedTime) render();
  else registerInformedTimeStr(txtInformedTime.value);
});

  function randomTimeStr() {
    return ("0" + Math.round(Math.random() * 12)).slice(-2)
      + ("0" + Math.round(Math.random() * 59)).slice(-2);
  }

  function timeStrToClock(timeString) {
    if (!timeString['match']) return;
    if (timeString.length === 3) timeString = "0" + timeString;
    const match = timeString.match(/^(\d{2})(\d{2})$/);
    if (!match) return;
    const h = parseInt(match[1]);
    if (h < 0 || h > 12) return;
    const m = parseInt(match[2]);
    if (m > 59) return;
    // 0 deg angles are on top, by convention
    const mAngle = m * 6;
    const hAngle = (h * 30 % 360) + (mAngle / 12);
    const hAngleRad = hAngle * Math.PI / 180;
    const mAngleRad = mAngle * Math.PI / 180;
    return {h, m, hAngle, mAngle, hAngleRad, mAngleRad};
  }

  function displayTimeInClock(clockParams) {
    const adjHAngle = clockParams.hAngle - 90;
    const adjMAngle = clockParams.mAngle - 90;
    document.getElementById('hoursPointer')
      .setAttribute('style', `transform: rotate(${adjHAngle}deg)`);
    document.getElementById('minutesPointer')
      .setAttribute('style', `transform: rotate(${adjMAngle}deg)`);
  }

  function errorMagnitude(clockA, clockB) {
    // There's probably a way more elegant way to implement this....
    //debugger;
    if (!clockA || !clockB) throw Error("One or more invalid time strings");
    const absTimeA = clockA.h * 60 + clockA.m;
    const absTimeB = clockB.h * 60 + clockB.m;
    let absDiff = Math.abs(absTimeA - absTimeB);
    const errorMinutes = Math.abs(absDiff > 360 ? absDiff -= 720 : absDiff);
    console.log(JSON.stringify({errorMinutes, clockA, clockB}));
    return errorMinutes;
  }

  function reset() {
    currentlyDisplayedTime = null;
    errorMagnitudes = [];
    statistics = {avgErrorMag: 0};
    render();
  }

  function render() {
    currentlyDisplayedTime = timeStrToClock(randomTimeStr());
    displayTimeInClock(currentlyDisplayedTime);
    txtInformedTime.value = '';
  }

  function registerInformedTimeStr(timeStr) {
    const errorMag = errorMagnitude(currentlyDisplayedTime, timeStrToClock(timeStr));
    errorMagnitudes.push({errorMag});
    statistics = {avgErrorMag: (statistics.avgErrorMag + errorMag) / 2.};
    render();
  }

</script>

</html>
